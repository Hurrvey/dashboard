# æ•°æ®çœ‹æ¿é¡¹ç›® - å‰ç«¯æŠ€æœ¯å¼€å‘æ–¹æ¡ˆ

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

åŸºäºç°æœ‰ code996 é¡¹ç›®çš„å¤šé¡¹ç›®æ±‡æ€»åŠŸèƒ½ï¼Œå¼€å‘ä¸€ä¸ªç«–å±æ•°æ®çœ‹æ¿å±•ç¤ºç³»ç»Ÿã€‚
æ•°æ®çœ‹æ¿ç”¨äºå®æ—¶å±•ç¤ºå›¢é˜Ÿçš„ä»£ç æäº¤æƒ…å†µå’Œ AI ç¼–å†™ä»£ç çš„æ¯”ä¾‹åˆ†æã€‚

---

## äºŒã€æŠ€æœ¯æ ˆé€‰å‹

### 2.1 æ ¸å¿ƒæŠ€æœ¯ï¼ˆç»§æ‰¿åŸé¡¹ç›®ï¼‰
- **æ¡†æ¶**: Vue 3 (Composition API)
- **è¯­è¨€**: TypeScript
- **æ„å»ºå·¥å…·**: Vite 2.x
- **æ ·å¼**: SCSS
- **å›¾è¡¨åº“**: chart.xkcd 1.1.13 (åƒç´ é£æ ¼æ‰‹ç»˜å›¾è¡¨)
- **HTTP è¯·æ±‚**: Fetch API / Axios

### 2.2 æ–°å¢ä¾èµ–
```json
{
  "dependencies": {
    "axios": "^1.6.0"  // HTTP è¯·æ±‚åº“ï¼ˆå¯é€‰ï¼Œä¹Ÿå¯ä½¿ç”¨ fetchï¼‰
  }
}
```

---

## ä¸‰ã€é¡¹ç›®ç»“æ„è®¾è®¡

```
dashboard/
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ favicon.ico
â”‚   â””â”€â”€ fonts/                    # åƒç´ å­—ä½“èµ„æº
â”‚       â”œâ”€â”€ vcr-osd.ttf
â”‚       â””â”€â”€ zpix.woff2
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.ts                   # å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ App.vue                   # æ ¹ç»„ä»¶
â”‚   â”œâ”€â”€ views/
â”‚   â”‚   â””â”€â”€ Dashboard.vue         # æ•°æ®çœ‹æ¿ä¸»è§†å›¾
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ charts/
â”‚   â”‚   â”‚   â”œâ”€â”€ BarChart.vue      # æŸ±çŠ¶å›¾ç»„ä»¶ï¼ˆå¤ç”¨ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ PieChart.vue      # é¥¼å›¾ç»„ä»¶ï¼ˆå¤ç”¨ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ BaseChart.vue     # å›¾è¡¨åŸºç¡€ç»„ä»¶ï¼ˆå¤ç”¨ï¼‰
â”‚   â”‚   â”œâ”€â”€ AICodeRatioChart.vue  # AI ä»£ç æ¯”ä¾‹å›¾è¡¨ï¼ˆæ–°å¢ï¼‰
â”‚   â”‚   â””â”€â”€ CommitScroller.vue    # æäº¤äººå‘˜æ»šåŠ¨ç»„ä»¶ï¼ˆæ–°å¢ï¼‰
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ dashboard.ts          # ä»ªè¡¨æ¿ç›¸å…³ API
â”‚   â”‚   â””â”€â”€ types.ts              # API ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ styles/
â”‚   â”‚   â”œâ”€â”€ reset.scss            # æ ·å¼é‡ç½®
â”‚   â”‚   â”œâ”€â”€ common.scss           # é€šç”¨æ ·å¼ï¼ˆå¤ç”¨ï¼‰
â”‚   â”‚   â”œâ”€â”€ variables.scss        # å˜é‡å®šä¹‰
â”‚   â”‚   â””â”€â”€ dashboard.scss        # çœ‹æ¿ä¸“å±æ ·å¼
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ request.ts            # HTTP è¯·æ±‚å°è£…
â”‚       â””â”€â”€ format.ts             # æ•°æ®æ ¼å¼åŒ–å·¥å…·
â”œâ”€â”€ index.html
â”œâ”€â”€ vite.config.ts
â”œâ”€â”€ tsconfig.json
â””â”€â”€ package.json
```

---

## å››ã€æ ¸å¿ƒåŠŸèƒ½æ¨¡å—è®¾è®¡

### 4.1 ä¸ŠåŠéƒ¨åˆ† - æ•°æ®å¯è§†åŒ–åŒºåŸŸ

#### 4.1.1 æ€»è§ˆå›¾è¡¨åŒºï¼ˆå·¦ä¾§ï¼‰
**åŠŸèƒ½**ï¼šå±•ç¤ºæ‰€æœ‰é¡¹ç›®çš„æ±‡æ€»ç»Ÿè®¡æ•°æ®

**å›¾è¡¨ç»„ä»¶**ï¼š
1. **æŒ‰å°æ—¶ commit åˆ†å¸ƒå›¾** (BarChart)
   - æ¨ªè½´ï¼š0-23 ç‚¹
   - çºµè½´ï¼šcommit æ¬¡æ•°
   - æ ·å¼ï¼šchart.xkcd çš„ Bar å›¾

2. **æŒ‰å¤© commit åˆ†å¸ƒå›¾** (BarChart)
   - æ¨ªè½´ï¼šå‘¨ä¸€~å‘¨æ—¥
   - çºµè½´ï¼šcommit æ¬¡æ•°
   - æ ·å¼ï¼šchart.xkcd çš„ Bar å›¾

3. **å·¥ä½œ/åŠ ç­æ—¶é—´å æ¯”å›¾** (PieChart)
   - æ•°æ®ï¼šå·¥ä½œæ—¶é—´ vs åŠ ç­æ—¶é—´
   - æ ·å¼ï¼šchart.xkcd çš„ Pie å›¾

4. **å·¥ä½œæ—¥/å‘¨æœ«å æ¯”å›¾** (PieChart)
   - æ•°æ®ï¼šå·¥ä½œæ—¥ vs å‘¨æœ«
   - æ ·å¼ï¼šchart.xkcd çš„ Pie å›¾

**æ•°æ®æ¥æº**ï¼š
- æ¥å£ï¼š`GET /api/dashboard/summary`
- æ•°æ®æ ¼å¼å‚è€ƒ code996_local.py çš„å¤šä»“åº“æ±‡æ€»ç»“æœ

#### 4.1.2 AI ä»£ç æ¯”ä¾‹å›¾ï¼ˆå³ä¾§ï¼Œæ–°å¢ï¼‰
**åŠŸèƒ½**ï¼šå±•ç¤ºæ‰€æœ‰é¡¹ç›®ä¸­ AI ç¼–å†™ä»£ç çš„æ¯”ä¾‹

**å›¾è¡¨ç±»å‹**ï¼šé¥¼å›¾ (PieChart)
- AI ç¼–å†™ï¼šxx%
- äººå·¥ç¼–å†™ï¼šxx%
- æ ·å¼ï¼šchart.xkcd çš„ Pie å›¾
- ä¸»é¢˜é¢œè‰²ï¼š
  - AI ç¼–å†™ï¼š#4CAF50 (ç»¿è‰²)
  - äººå·¥ç¼–å†™ï¼š#de335e (ç²‰çº¢è‰²)

**æ•°æ®æ¥æº**ï¼š
- ä» URL å‚æ•°è·å–æ‰€æœ‰é¡¹ç›®åœ°å€
- å¯¹æ¯ä¸ªé¡¹ç›®å‘èµ· GET è¯·æ±‚åˆ°ï¼š`http://localhost:9970/api/ai-ratio?repo={repo_url}`
- æ±‡æ€»æ‰€æœ‰é¡¹ç›®çš„ AI ä»£ç æ¯”ä¾‹

**æ•°æ®è¯·æ±‚é€»è¾‘**ï¼š
```typescript
// ä¼ªä»£ç 
const projects = getProjectsFromURL(); // ä» URL å‚æ•°è·å–
const aiRatioPromises = projects.map(proj => 
  fetch(`http://localhost:9970/api/ai-ratio?repo=${proj}`)
);
const results = await Promise.all(aiRatioPromises);
// è®¡ç®—æ€»çš„ AI ä»£ç æ¯”ä¾‹
```

---

### 4.2 ä¸‹åŠéƒ¨åˆ† - è´¡çŒ®è€…æ»šåŠ¨å±•ç¤ºåŒºï¼ˆæ–°å¢ï¼‰

#### 4.2.1 æ»šåŠ¨å±•ç¤ºç»„ä»¶ (CommitScroller)

**åŠŸèƒ½**ï¼š
- å±•ç¤ºæ‰€æœ‰ commit è¿‡çš„äººå‘˜åŠå…¶ commit æ¬¡æ•°
- æ»šåŠ¨æ’­æ”¾ï¼Œå¾ªç¯å±•ç¤º
- åƒç´ é£æ ¼çš„å¡ç‰‡è®¾è®¡

**å±•ç¤ºæ ·å¼**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‘¤ Zhang San          245 commits â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ‘¤ Li Si              189 commits â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ‘¤ Wang Wu            156 commits â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ»šåŠ¨æ•ˆæœ**ï¼š
- ä½¿ç”¨ CSS animation æˆ– Vue transition å®ç°
- è‡ªåŠ¨æ»šåŠ¨ï¼Œé—´éš” 2-3 ç§’åˆ‡æ¢
- æ¯æ¬¡æ˜¾ç¤º 5-8 ä¸ªè´¡çŒ®è€…
- æ— ç¼å¾ªç¯

**æ’åºè§„åˆ™**ï¼š
- æŒ‰ commit æ•°é‡é™åºæ’åˆ—
- æ”¯æŒåˆ‡æ¢æ’åºæ–¹å¼ï¼ˆå¯é€‰ï¼‰

**æ•°æ®æ¥æº**ï¼š
- æ¥å£ï¼š`GET /api/dashboard/contributors`
- è¿”å›æ‰€æœ‰é¡¹ç›®çš„è´¡çŒ®è€…åˆ—è¡¨

---

## äº”ã€å¸ƒå±€è®¾è®¡

### 5.1 ç«–å±å¸ƒå±€æ–¹æ¡ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Header (é¡¶éƒ¨æ ‡é¢˜æ )        â”‚  10vh
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 â”‚               â”‚
â”‚   æ€»è§ˆå›¾è¡¨åŒº      â”‚  AI ä»£ç æ¯”ä¾‹å›¾  â”‚  45vh
â”‚  (4ä¸ªå›¾è¡¨ 2x2)   â”‚  (å¤§é¥¼å›¾)      â”‚
â”‚                 â”‚               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚      è´¡çŒ®è€…æ»šåŠ¨å±•ç¤ºåŒº              â”‚  45vh
â”‚    (è‡ªåŠ¨æ»šåŠ¨çš„è´¡çŒ®è€…åˆ—è¡¨)          â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 å“åº”å¼è®¾è®¡

**å±å¹•é€‚é…ç­–ç•¥**ï¼š
```scss
// ä½¿ç”¨ vh å•ä½å®ç°ç«–å±è‡ªé€‚åº”
.dashboard {
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  
  .top-section {
    height: 55vh;
    display: flex;
    
    .charts-grid {
      flex: 3;
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: 1fr 1fr;
      gap: 20px;
      padding: 20px;
    }
    
    .ai-ratio-panel {
      flex: 2;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
  }
  
  .bottom-section {
    height: 45vh;
    overflow: hidden;
  }
}

// å°å±é€‚é…
@media (max-height: 800px) {
  .charts-grid {
    gap: 10px !important;
    padding: 10px !important;
  }
}
```

---

## å…­ã€æ•°æ®æµè®¾è®¡

### 6.1 æ•°æ®è·å–æµç¨‹

```
å¯åŠ¨çœ‹æ¿
    â†“
è§£æ URL å‚æ•° (è·å–é¡¹ç›®åˆ—è¡¨)
    â†“
å¹¶è¡Œè¯·æ±‚ â†“
    â”œâ”€â†’ è¯·æ±‚ /api/dashboard/summary (æ±‡æ€»æ•°æ®)
    â”œâ”€â†’ è¯·æ±‚ /api/dashboard/contributors (è´¡çŒ®è€…)
    â””â”€â†’ æ‰¹é‡è¯·æ±‚ http://localhost:9970/api/ai-ratio (AI æ¯”ä¾‹)
    â†“
æ•°æ®å¤„ç† & æ ¼å¼åŒ–
    â†“
æ¸²æŸ“å›¾è¡¨ & å¯åŠ¨æ»šåŠ¨åŠ¨ç”»
    â†“
å®šæ—¶åˆ·æ–° (å¯é€‰ï¼Œå¦‚ 5 åˆ†é’Ÿåˆ·æ–°ä¸€æ¬¡)
```

### 6.2 æ•°æ®åˆ·æ–°ç­–ç•¥

**æ–¹æ¡ˆä¸€ï¼šå®šæ—¶è½®è¯¢**
```typescript
// æ¯ 5 åˆ†é’Ÿåˆ·æ–°ä¸€æ¬¡æ•°æ®
setInterval(() => {
  fetchDashboardData();
}, 5 * 60 * 1000);
```

**æ–¹æ¡ˆäºŒï¼šWebSocket å®æ—¶æ¨é€**ï¼ˆå¯é€‰ï¼‰
- å¦‚éœ€å®æ—¶æ›´æ–°ï¼Œå¯æ”¹ç”¨ WebSocket
- æœåŠ¡ç«¯æ¨é€æ–°çš„ commit æ•°æ®
- å‰ç«¯å®æ—¶æ›´æ–°å›¾è¡¨

---

## ä¸ƒã€æ ·å¼è®¾è®¡è§„èŒƒ

### 7.1 ä¸»é¢˜è‰²å½©

```scss
// ç»§æ‰¿åŸé¡¹ç›®çš„åƒç´ é£æ ¼é…è‰²
$bg-primary: #212121;      // ä¸»èƒŒæ™¯è‰²
$bg-secondary: #2a2a2a;    // æ¬¡èƒŒæ™¯è‰²
$text-primary: #ccc;       // ä¸»æ–‡å­—è‰²
$text-secondary: #999;     // æ¬¡æ–‡å­—è‰²
$accent-color: #de335e;    // å¼ºè°ƒè‰²ï¼ˆç²‰çº¢ï¼‰
$ai-color: #4CAF50;        // AI ä»£ç è‰²ï¼ˆç»¿è‰²ï¼‰
$chart-stroke: #fff;       // å›¾è¡¨çº¿æ¡è‰²
```

### 7.2 å­—ä½“

```scss
@font-face {
  font-family: 'vcr-osd';
  src: url('https://fastly.jsdelivr.net/gh/hellodigua/cdn/fonts/vcr-osd.ttf');
  font-display: swap;
}

@font-face {
  font-family: 'Pixel';
  src: url('https://fastly.jsdelivr.net/gh/hellodigua/cdn/fonts/zpix.woff2') format('woff2');
  font-display: swap;
}

body {
  font-family: 'Pixel', sans-serif;
  background-color: $bg-primary;
  color: $text-primary;
}

h1, h2 {
  font-family: 'vcr-osd', monospace;
}
```

### 7.3 åƒç´ é£æ ¼å¡ç‰‡

```scss
.pixel-card {
  background-color: $bg-secondary;
  box-shadow: 8px 8px 0px rgba(0, 0, 0, 0.2);
  border: 2px solid $text-secondary;
  padding: 20px;
  transition: transform 0.2s;
  
  &:hover {
    transform: translate(-2px, -2px);
    box-shadow: 10px 10px 0px rgba(0, 0, 0, 0.3);
  }
}
```

---

## å…«ã€æ ¸å¿ƒç»„ä»¶å®ç°

### 8.1 Dashboard.vue (ä¸»è§†å›¾)

```vue
<template>
  <div class="dashboard">
    <!-- é¡¶éƒ¨æ ‡é¢˜ -->
    <header class="dashboard-header">
      <h1>CODE996 DATA DASHBOARD</h1>
      <div class="meta">
        <span>Projects: {{ projectCount }}</span>
        <span>Total Commits: {{ totalCommits }}</span>
        <span class="time">{{ currentTime }}</span>
      </div>
    </header>
    
    <!-- ä¸ŠåŠéƒ¨åˆ† -->
    <section class="top-section">
      <!-- å·¦ä¾§ï¼šæ€»è§ˆå›¾è¡¨ -->
      <div class="charts-grid">
        <div class="chart-item">
          <h2>æŒ‰å°æ—¶ commit åˆ†å¸ƒ</h2>
          <BarChart :data="hourData" />
        </div>
        <div class="chart-item">
          <h2>å·¥ä½œ/åŠ ç­å æ¯”ï¼ˆæŒ‰å°æ—¶ï¼‰</h2>
          <PieChart :data="workHourRatio" />
        </div>
        <div class="chart-item">
          <h2>æŒ‰å¤© commit åˆ†å¸ƒ</h2>
          <BarChart :data="weekData" />
        </div>
        <div class="chart-item">
          <h2>å·¥ä½œæ—¥/å‘¨æœ«å æ¯”</h2>
          <PieChart :data="workWeekRatio" />
        </div>
      </div>
      
      <!-- å³ä¾§ï¼šAI ä»£ç æ¯”ä¾‹ -->
      <div class="ai-ratio-panel">
        <AICodeRatioChart :data="aiRatioData" :loading="aiRatioLoading" />
      </div>
    </section>
    
    <!-- ä¸‹åŠéƒ¨åˆ† -->
    <section class="bottom-section">
      <CommitScroller :contributors="contributors" />
    </section>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted, onUnmounted } from 'vue';
import { fetchDashboardData, fetchAIRatio } from '@/api/dashboard';
// ... å…¶ä»–å¯¼å…¥

// å“åº”å¼æ•°æ®
const projectCount = ref(0);
const totalCommits = ref(0);
const currentTime = ref('');
const hourData = ref([]);
const weekData = ref([]);
const workHourRatio = ref([]);
const workWeekRatio = ref([]);
const aiRatioData = ref([]);
const aiRatioLoading = ref(true);
const contributors = ref([]);

// æ›´æ–°æ—¶é—´
const updateTime = () => {
  currentTime.value = new Date().toLocaleString('zh-CN', {
    year: 'numeric',
    month: '2-digit',
    day: '2-digit',
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit'
  });
};

// åˆå§‹åŒ–æ•°æ®
const initDashboard = async () => {
  try {
    // ä» URL è·å–é¡¹ç›®åˆ—è¡¨
    const urlParams = new URLSearchParams(window.location.search);
    const projectsParam = urlParams.get('projects');
    const projects = projectsParam ? projectsParam.split(',') : [];
    
    // å¹¶è¡Œè¯·æ±‚æ•°æ®
    const [summaryData, contributorsData] = await Promise.all([
      fetchDashboardData(projects),
      fetchContributors(projects)
    ]);
    
    // æ›´æ–°æ€»è§ˆæ•°æ®
    projectCount.value = summaryData.repo_count;
    totalCommits.value = summaryData.total_count;
    hourData.value = summaryData.hour_data;
    weekData.value = summaryData.week_data;
    workHourRatio.value = summaryData.work_hour_pl;
    workWeekRatio.value = summaryData.work_week_pl;
    
    // æ›´æ–°è´¡çŒ®è€…æ•°æ®
    contributors.value = contributorsData;
    
    // è¯·æ±‚ AI ä»£ç æ¯”ä¾‹
    fetchAIRatioData(projects);
    
  } catch (error) {
    console.error('åˆå§‹åŒ–å¤±è´¥:', error);
  }
};

// è¯·æ±‚ AI ä»£ç æ¯”ä¾‹
const fetchAIRatioData = async (projects: string[]) => {
  try {
    aiRatioLoading.value = true;
    const ratioData = await fetchAIRatio(projects);
    aiRatioData.value = ratioData;
  } catch (error) {
    console.error('è·å– AI æ¯”ä¾‹å¤±è´¥:', error);
  } finally {
    aiRatioLoading.value = false;
  }
};

// å®šæ—¶åˆ·æ–°
let refreshTimer: number;

onMounted(() => {
  initDashboard();
  updateTime();
  
  // æ¯ç§’æ›´æ–°æ—¶é—´
  setInterval(updateTime, 1000);
  
  // æ¯ 5 åˆ†é’Ÿåˆ·æ–°æ•°æ®
  refreshTimer = setInterval(initDashboard, 5 * 60 * 1000);
});

onUnmounted(() => {
  clearInterval(refreshTimer);
});
</script>

<style lang="scss" scoped>
@import '@/styles/dashboard.scss';
</style>
```

### 8.2 AICodeRatioChart.vue (AI ä»£ç æ¯”ä¾‹å›¾è¡¨)

```vue
<template>
  <div class="ai-ratio-chart">
    <h2>AI ç¼–å†™ä»£ç æ¯”ä¾‹</h2>
    <div class="chart-wrapper" v-if="!loading">
      <PieChart :data="chartData" :options="chartOptions" />
      <div class="stats">
        <div class="stat-item ai">
          <span class="label">AI ç¼–å†™</span>
          <span class="value">{{ aiPercentage }}%</span>
        </div>
        <div class="stat-item human">
          <span class="label">äººå·¥ç¼–å†™</span>
          <span class="value">{{ humanPercentage }}%</span>
        </div>
      </div>
    </div>
    <div class="loading" v-else>
      <div class="pixel-spinner"></div>
      <p>åŠ è½½ä¸­...</p>
    </div>
  </div>
</template>

<script setup lang="ts">
import { computed } from 'vue';
import PieChart from './charts/PieChart.vue';

const props = defineProps<{
  data: { ai_lines: number; human_lines: number };
  loading: boolean;
}>();

const aiPercentage = computed(() => {
  const total = props.data.ai_lines + props.data.human_lines;
  return total > 0 ? ((props.data.ai_lines / total) * 100).toFixed(1) : 0;
});

const humanPercentage = computed(() => {
  const total = props.data.ai_lines + props.data.human_lines;
  return total > 0 ? ((props.data.human_lines / total) * 100).toFixed(1) : 0;
});

const chartData = computed(() => [
  { time: 'AIç¼–å†™', count: props.data.ai_lines },
  { time: 'äººå·¥ç¼–å†™', count: props.data.human_lines }
]);

const chartOptions = {
  backgroundColor: '#212121',
  strokeColor: '#fff',
};
</script>

<style lang="scss" scoped>
.ai-ratio-chart {
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  background-color: #2a2a2a;
  padding: 20px;
  box-shadow: 10px 10px 0px rgba(0, 0, 0, 0.1);
  
  h2 {
    font-size: 1.5em;
    margin-bottom: 20px;
    text-align: center;
    color: #fff;
  }
  
  .chart-wrapper {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  
  .stats {
    display: flex;
    gap: 40px;
    margin-top: 30px;
    
    .stat-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      
      .label {
        font-size: 1em;
        color: #999;
        margin-bottom: 10px;
      }
      
      .value {
        font-size: 2em;
        font-family: 'vcr-osd', monospace;
        font-weight: bold;
      }
      
      &.ai .value {
        color: #4CAF50;
      }
      
      &.human .value {
        color: #de335e;
      }
    }
  }
  
  .loading {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    
    p {
      margin-top: 20px;
      color: #999;
    }
  }
}

// åƒç´ é£æ ¼åŠ è½½åŠ¨ç”»
.pixel-spinner {
  width: 40px;
  height: 40px;
  border: 4px solid #555;
  border-top-color: #de335e;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}
</style>
```

### 8.3 CommitScroller.vue (è´¡çŒ®è€…æ»šåŠ¨ç»„ä»¶)

```vue
<template>
  <div class="commit-scroller">
    <h2>ğŸ† Top Contributors</h2>
    <div class="scroller-container">
      <transition-group name="slide" tag="div" class="contributor-list">
        <div 
          v-for="contributor in visibleContributors" 
          :key="contributor.email"
          class="contributor-card"
        >
          <div class="rank">{{ contributor.rank }}</div>
          <div class="avatar">ğŸ‘¤</div>
          <div class="info">
            <div class="name">{{ contributor.name }}</div>
            <div class="email">{{ contributor.email }}</div>
          </div>
          <div class="commits">
            <span class="count">{{ contributor.commits }}</span>
            <span class="label">commits</span>
          </div>
        </div>
      </transition-group>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted, onUnmounted } from 'vue';

interface Contributor {
  name: string;
  email: string;
  commits: number;
  rank: number;
}

const props = defineProps<{
  contributors: Contributor[];
}>();

const currentIndex = ref(0);
const pageSize = 6; // æ¯é¡µæ˜¾ç¤º 6 ä¸ª

// å½“å‰å¯è§çš„è´¡çŒ®è€…
const visibleContributors = computed(() => {
  const start = currentIndex.value;
  const end = start + pageSize;
  return props.contributors.slice(start, end);
});

// è‡ªåŠ¨æ»šåŠ¨
let scrollTimer: number;

const autoScroll = () => {
  currentIndex.value += 1;
  
  // å¾ªç¯æ»šåŠ¨
  if (currentIndex.value >= props.contributors.length) {
    currentIndex.value = 0;
  }
};

onMounted(() => {
  // æ¯ 3 ç§’æ»šåŠ¨ä¸€æ¬¡
  scrollTimer = setInterval(autoScroll, 3000);
});

onUnmounted(() => {
  clearInterval(scrollTimer);
});
</script>

<style lang="scss" scoped>
.commit-scroller {
  width: 100%;
  height: 100%;
  background-color: #212121;
  padding: 30px;
  overflow: hidden;
  
  h2 {
    font-size: 2em;
    text-align: center;
    margin-bottom: 30px;
    color: #de335e;
    text-shadow: 6px 6px 0px rgba(0, 0, 0, 0.2);
  }
  
  .scroller-container {
    height: calc(100% - 100px);
    overflow: hidden;
  }
  
  .contributor-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }
  
  .contributor-card {
    display: flex;
    align-items: center;
    background-color: #2a2a2a;
    padding: 20px 30px;
    box-shadow: 8px 8px 0px rgba(0, 0, 0, 0.2);
    border: 2px solid #444;
    transition: all 0.3s;
    
    &:hover {
      transform: translateX(10px);
      border-color: #de335e;
    }
    
    .rank {
      font-size: 2em;
      font-family: 'vcr-osd', monospace;
      color: #de335e;
      min-width: 60px;
      text-align: center;
    }
    
    .avatar {
      font-size: 3em;
      margin: 0 30px;
    }
    
    .info {
      flex: 1;
      
      .name {
        font-size: 1.5em;
        color: #fff;
        margin-bottom: 8px;
      }
      
      .email {
        font-size: 0.9em;
        color: #999;
      }
    }
    
    .commits {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-left: 30px;
      
      .count {
        font-size: 2.5em;
        font-family: 'vcr-osd', monospace;
        color: #4CAF50;
        font-weight: bold;
      }
      
      .label {
        font-size: 0.9em;
        color: #999;
        margin-top: 5px;
      }
    }
  }
}

// æ»‘åŠ¨åŠ¨ç”»
.slide-enter-active,
.slide-leave-active {
  transition: all 0.5s ease;
}

.slide-enter-from {
  transform: translateY(100%);
  opacity: 0;
}

.slide-leave-to {
  transform: translateY(-100%);
  opacity: 0;
}
</style>
```

---

## ä¹ã€API å°è£…

### 9.1 api/dashboard.ts

```typescript
import axios from 'axios';
import type { DashboardSummary, Contributor, AIRatioData } from './types';

const API_BASE = '/api/dashboard';
const AI_SERVICE_BASE = 'http://localhost:9970';

/**
 * è·å–ä»ªè¡¨æ¿æ±‡æ€»æ•°æ®
 */
export async function fetchDashboardData(projects: string[]): Promise<DashboardSummary> {
  const response = await axios.get(`${API_BASE}/summary`, {
    params: { projects: projects.join(',') }
  });
  return response.data;
}

/**
 * è·å–è´¡çŒ®è€…åˆ—è¡¨
 */
export async function fetchContributors(projects: string[]): Promise<Contributor[]> {
  const response = await axios.get(`${API_BASE}/contributors`, {
    params: { projects: projects.join(',') }
  });
  return response.data;
}

/**
 * è·å– AI ä»£ç æ¯”ä¾‹ï¼ˆæ‰¹é‡ï¼‰
 */
export async function fetchAIRatio(projects: string[]): Promise<AIRatioData> {
  try {
    // å¹¶è¡Œè¯·æ±‚æ‰€æœ‰é¡¹ç›®çš„ AI æ¯”ä¾‹
    const promises = projects.map(repo =>
      axios.get(`${AI_SERVICE_BASE}/api/ai-ratio`, {
        params: { repo },
        timeout: 10000 // 10 ç§’è¶…æ—¶
      })
    );
    
    const results = await Promise.all(promises);
    
    // æ±‡æ€»æ‰€æœ‰é¡¹ç›®çš„æ•°æ®
    const totalAiLines = results.reduce((sum, res) => sum + (res.data.ai_lines || 0), 0);
    const totalHumanLines = results.reduce((sum, res) => sum + (res.data.human_lines || 0), 0);
    
    return {
      ai_lines: totalAiLines,
      human_lines: totalHumanLines,
      projects: results.length
    };
  } catch (error) {
    console.error('è·å– AI æ¯”ä¾‹å¤±è´¥:', error);
    // è¿”å›é»˜è®¤æ•°æ®
    return { ai_lines: 0, human_lines: 0, projects: 0 };
  }
}
```

### 9.2 api/types.ts

```typescript
/**
 * ä»ªè¡¨æ¿æ±‡æ€»æ•°æ®
 */
export interface DashboardSummary {
  start_date: string;
  end_date: string;
  total_count: number;
  repo_count: number;
  hour_data: TimeCount[];
  week_data: TimeCount[];
  work_hour_pl: TimeCount[];
  work_week_pl: TimeCount[];
  index_996: number;
  overtime_ratio: number;
  is_standard: boolean;
}

export interface TimeCount {
  time: string;
  count: number;
}

/**
 * è´¡çŒ®è€…æ•°æ®
 */
export interface Contributor {
  rank: number;
  name: string;
  email: string;
  commits: number;
  additions?: number;
  deletions?: number;
}

/**
 * AI ä»£ç æ¯”ä¾‹æ•°æ®
 */
export interface AIRatioData {
  ai_lines: number;
  human_lines: number;
  projects: number;
}
```

---

## åã€éƒ¨ç½²æ–¹æ¡ˆ

### 10.1 å¼€å‘ç¯å¢ƒ
```bash
# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# è®¿é—®åœ°å€
# http://localhost:3800/?projects=repo1,repo2,repo3
```

### 10.2 ç”Ÿäº§ç¯å¢ƒ
```bash
# æ„å»ºé¡¹ç›®
npm run build

# éƒ¨ç½² dist ç›®å½•åˆ°é™æ€æœåŠ¡å™¨
# å¦‚ï¼šNginxã€Apacheã€Caddy ç­‰
```

### 10.3 URL å‚æ•°è¯´æ˜
```
http://your-dashboard.com/?projects=project1,project2,project3
```
- `projects`: é€—å·åˆ†éš”çš„é¡¹ç›®æ ‡è¯†åˆ—è¡¨

---

## åä¸€ã€å¼€å‘ä¼˜å…ˆçº§

### Phase 1: åŸºç¡€æ¡†æ¶ (1-2å¤©)
1. âœ… æ­å»º Vite + Vue 3 + TypeScript é¡¹ç›®
2. âœ… å¤ç”¨åŸé¡¹ç›®çš„æ ·å¼å’Œå­—ä½“
3. âœ… å®ç°åŸºç¡€å¸ƒå±€ï¼ˆä¸Šä¸‹ä¸¤éƒ¨åˆ†ï¼‰

### Phase 2: æ•°æ®å¯è§†åŒ– (2-3å¤©)
4. âœ… å¤ç”¨ BarChart å’Œ PieChart ç»„ä»¶
5. âœ… å®ç°æ€»è§ˆå›¾è¡¨å±•ç¤º
6. âœ… å®ç° AI ä»£ç æ¯”ä¾‹å›¾è¡¨
7. âœ… å¯¹æ¥åç«¯ API

### Phase 3: æ»šåŠ¨å±•ç¤º (1-2å¤©)
8. âœ… å®ç°è´¡çŒ®è€…æ»šåŠ¨ç»„ä»¶
9. âœ… å®ç°æ»šåŠ¨åŠ¨ç”»æ•ˆæœ

### Phase 4: ä¼˜åŒ–å®Œå–„ (1å¤©)
10. âœ… å“åº”å¼é€‚é…
11. âœ… åŠ è½½çŠ¶æ€ä¼˜åŒ–
12. âœ… é”™è¯¯å¤„ç†

**é¢„è®¡æ€»å¼€å‘æ—¶é—´: 5-8 ä¸ªå·¥ä½œæ—¥**

---

## åäºŒã€æ³¨æ„äº‹é¡¹

1. **æ€§èƒ½ä¼˜åŒ–**
   - å›¾è¡¨ä½¿ç”¨ chart.xkcd å¯èƒ½æ€§èƒ½æœ‰é™ï¼Œå¤§æ•°æ®é›†éœ€ä¼˜åŒ–
   - è€ƒè™‘ä½¿ç”¨ `requestAnimationFrame` ä¼˜åŒ–æ»šåŠ¨åŠ¨ç”»
   - é¿å…é¢‘ç¹çš„ DOM æ“ä½œ

2. **é”™è¯¯å¤„ç†**
   - AI æ¥å£å¯èƒ½è¶…æ—¶æˆ–å¤±è´¥ï¼Œéœ€è¦é™çº§å¤„ç†
   - æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤º
   - æä¾›é‡è¯•æœºåˆ¶

3. **æµè§ˆå™¨å…¼å®¹æ€§**
   - ä¸»è¦æ”¯æŒç°ä»£æµè§ˆå™¨ï¼ˆChrome, Edge, Firefoxï¼‰
   - éœ€è¦æ”¯æŒ CSS Grid å’Œ Flexbox
   - å­—ä½“åŠ è½½å¤±è´¥æ—¶çš„é™çº§æ–¹æ¡ˆ

4. **æ•°æ®åˆ·æ–°**
   - é¿å…è¿‡äºé¢‘ç¹çš„è¯·æ±‚
   - å®ç°è¯·æ±‚å»é‡å’Œé˜²æŠ–
   - è€ƒè™‘ä½¿ç”¨ç¼“å­˜ç­–ç•¥

5. **å¤§å±å±•ç¤º**
   - é’ˆå¯¹å¤§å±ä¼˜åŒ–å­—ä½“å¤§å°
   - è€ƒè™‘ä½¿ç”¨ 4K æˆ–è¶…å®½å±å¹•çš„é€‚é…
   - æµ‹è¯•ä¸åŒåˆ†è¾¨ç‡ä¸‹çš„æ˜¾ç¤ºæ•ˆæœ

---

## åä¸‰ã€æœªæ¥æ‰©å±•

1. **å®æ—¶æ•°æ®æ¨é€**: WebSocket æ”¯æŒ
2. **å¤šè¯­è¨€æ”¯æŒ**: i18n å›½é™…åŒ–
3. **ä¸»é¢˜åˆ‡æ¢**: æ”¯æŒæµ…è‰²/æ·±è‰²ä¸»é¢˜
4. **æ•°æ®å¯¼å‡º**: å¯¼å‡ºæŠ¥è¡¨åŠŸèƒ½
5. **å‘Šè­¦åŠŸèƒ½**: å¼‚å¸¸æ•°æ®å‘Šè­¦
6. **æ•°æ®ç­›é€‰**: æ—¶é—´èŒƒå›´ã€é¡¹ç›®ç­›é€‰

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-10-31
**ä½œè€…**: AI Assistant

